# Appointment Management System

## T·ªïng quan

H·ªá th·ªëng qu·∫£n l√Ω appointments (l·ªãch h·∫πn) cho admin v·ªõi ƒë·∫ßy ƒë·ªß t√≠nh nƒÉng CRUD, th·ªëng k√™ v√† bi·ªÉu ƒë·ªì tr·ª±c quan.

## T√≠nh nƒÉng ch√≠nh

### 1. Appointment Management (`AppointmentManagement.js`)

#### Ch·ª©c nƒÉng:
- ‚úÖ **Xem danh s√°ch appointments** - Hi·ªÉn th·ªã t·∫•t c·∫£ appointments v·ªõi th√¥ng tin chi ti·∫øt
- ‚úÖ **T√¨m ki·∫øm** - T√¨m theo t√™n b·ªánh nh√¢n, b√°c sƒ© ho·∫∑c ID appointment
- ‚úÖ **L·ªçc theo status** - PENDING, CONFIRMED, COMPLETED, CANCELLED
- ‚úÖ **Xem chi ti·∫øt** - Modal hi·ªÉn th·ªã th√¥ng tin ƒë·∫ßy ƒë·ªß
- ‚úÖ **Ch·ªânh s·ª≠a** - C·∫≠p nh·∫≠t ng√†y, gi·ªù, status, ghi ch√∫
- ‚úÖ **X√≥a appointment** - V·ªõi x√°c nh·∫≠n tr∆∞·ªõc khi x√≥a
- ‚úÖ **C·∫≠p nh·∫≠t status** - Thay ƒë·ªïi tr·∫°ng th√°i appointment

#### Giao di·ªán:
- üìä B·∫£ng hi·ªÉn th·ªã v·ªõi pagination
- üé® Status badges v·ªõi m√†u s·∫Øc ph√¢n bi·ªát
- üîç Search v√† filter controls
- üì± Responsive design
- ‚ö° Loading states v√† error handling

### 2. Appointment Statistics (`AppointmentStatsDashboard.js`)

#### Ch·ª©c nƒÉng:
- ‚úÖ **Summary Cards** - T·ªïng appointments, h√¥m nay, th√°ng n√†y, nƒÉm nay
- ‚úÖ **Pie Chart** - Ph√¢n b·ªë theo status
- ‚úÖ **Bar Chart** - Xu h∆∞·ªõng theo th√°ng
- ‚úÖ **Area Chart** - Xu h∆∞·ªõng theo ng√†y (7 ng√†y g·∫ßn nh·∫•t)
- ‚úÖ **Line Chart** - So s√°nh status
- ‚úÖ **Detailed Table** - B·∫£ng chi ti·∫øt v·ªõi t·ª∑ l·ªá ph·∫ßn trƒÉm

#### Charts s·ª≠ d·ª•ng:
- üìà **Recharts** - Th∆∞ vi·ªán chart hi·ªán ƒë·∫°i
- üé® **Responsive** - T·ª± ƒë·ªông ƒëi·ªÅu ch·ªânh k√≠ch th∆∞·ªõc
- üåà **Color coding** - M√†u s·∫Øc ph√¢n bi·ªát cho t·ª´ng status

## C·∫•u tr√∫c Backend

### 1. Models
```java
// Appointment.java
@Entity
public class Appointment {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    @ManyToOne
    @JoinColumn(name = "patient_id")
    private Patient patient;
    
    @ManyToOne
    @JoinColumn(name = "doctor_id")
    private Doctor doctor;
    
    private LocalDateTime appointmentDate;
    private String appointmentTime;
    private String status; // PENDING, CONFIRMED, COMPLETED, CANCELLED
    private String notes;
    private LocalDateTime createdAt;
    private LocalDateTime updatedAt;
}
```

### 2. DTOs
```java
// AppointmentDTO.java
public class AppointmentDTO {
    private Long id;
    private PatientDTO patient;
    private DoctorDTO doctor;
    private String appointmentDate;
    private String appointmentTime;
    private String status;
    private String notes;
    private String createdAt;
    private String updatedAt;
}
```

### 3. Repository
```java
// AppointmentRepository.java
@Repository
public interface AppointmentRepository extends JpaRepository<Appointment, Long> {
    // CRUD operations
    List<Appointment> findByStatus(String status);
    List<Appointment> findByPatientId(Long patientId);
    List<Appointment> findByDoctorId(Long doctorId);
    
    // Statistics queries
    @Query("SELECT COUNT(a) FROM Appointment a WHERE CAST(a.createdAt AS date) = CAST(GETDATE() AS date)")
    Long countTodayAppointments();
    
    @Query("SELECT a.status, COUNT(a) FROM Appointment a GROUP BY a.status")
    List<Object[]> getStatusCounts();
    
    @Query("SELECT CAST(a.createdAt AS date) as date, COUNT(a) FROM Appointment a " +
           "WHERE a.createdAt >= DATEADD(day, -7, GETDATE()) " +
           "GROUP BY CAST(a.createdAt AS date) ORDER BY date")
    List<Object[]> getDailyStats();
}
```

### 4. Service
```java
// AppointmentService.java
@Service
public class AppointmentService {
    // CRUD operations
    public List<AppointmentDTO> getAllAppointments();
    public AppointmentDTO getAppointmentById(Long id);
    public AppointmentDTO updateAppointment(Long id, AppointmentDTO dto);
    public void deleteAppointment(Long id);
    public AppointmentDTO updateStatus(Long id, String status);
    
    // Statistics
    public Map<String, Object> getAppointmentStats();
}
```

### 5. Controller
```java
// AdminAppointmentController.java
@RestController
@RequestMapping("/api/admin/appointments")
public class AdminAppointmentController {
    // REST endpoints
    @GetMapping
    public ResponseEntity<List<AppointmentDTO>> getAllAppointments();
    
    @GetMapping("/{id}")
    public ResponseEntity<AppointmentDTO> getAppointmentById(@PathVariable Long id);
    
    @PutMapping("/{id}")
    public ResponseEntity<AppointmentDTO> updateAppointment(@PathVariable Long id, @RequestBody AppointmentDTO dto);
    
    @DeleteMapping("/{id}")
    public ResponseEntity<Void> deleteAppointment(@PathVariable Long id);
    
    @PatchMapping("/{id}/status")
    public ResponseEntity<AppointmentDTO> updateStatus(@PathVariable Long id, @RequestBody String status);
    
    @GetMapping("/stats")
    public ResponseEntity<Map<String, Object>> getAppointmentStats();
}
```

## C·∫•u tr√∫c Frontend

### 1. Service Layer
```javascript
// AppointmentService.js
class AppointmentService {
    // Admin management methods
    getAllAppointments() { /* ... */ }
    getAppointmentById(id) { /* ... */ }
    updateAppointment(id, data) { /* ... */ }
    deleteAppointment(id) { /* ... */ }
    updateAppointmentStatus(id, status) { /* ... */ }
    getAppointmentStats() { /* ... */ }
    
    // Existing user booking methods (unchanged)
    bookAppointment(userId, appointmentData) { /* ... */ }
    createPayment(userId, paymentData) { /* ... */ }
}
```

### 2. Components
```javascript
// AppointmentManagement.js
const AppointmentManagement = () => {
    // State management
    const [appointments, setAppointments] = useState([]);
    const [loading, setLoading] = useState(true);
    const [searchTerm, setSearchTerm] = useState('');
    const [statusFilter, setStatusFilter] = useState('all');
    
    // Functions
    const loadAppointments = async () => { /* ... */ };
    const handleViewAppointment = (appointment) => { /* ... */ };
    const handleEditAppointment = (appointment) => { /* ... */ };
    const handleDeleteAppointment = (appointment) => { /* ... */ };
    const handleSaveEdit = async () => { /* ... */ };
    
    return (
        <div>
            {/* Search and Filter */}
            {/* Appointments Table */}
            {/* View/Edit Modal */}
            {/* Delete Confirmation Modal */}
        </div>
    );
};
```

```javascript
// AppointmentStatsDashboard.js
const AppointmentStatsDashboard = () => {
    // State management
    const [stats, setStats] = useState(null);
    const [loading, setLoading] = useState(true);
    
    // Charts data preparation
    const statusData = [/* ... */];
    const monthlyData = [/* ... */];
    const dailyData = [/* ... */];
    
    return (
        <div>
            {/* Summary Cards */}
            {/* Charts Grid */}
            {/* Detailed Statistics Table */}
        </div>
    );
};
```

## API Endpoints

### Admin Management APIs
```
GET    /api/admin/appointments           - L·∫•y t·∫•t c·∫£ appointments
GET    /api/admin/appointments/{id}      - L·∫•y appointment theo ID
PUT    /api/admin/appointments/{id}      - C·∫≠p nh·∫≠t appointment
DELETE /api/admin/appointments/{id}      - X√≥a appointment
PATCH  /api/admin/appointments/{id}/status - C·∫≠p nh·∫≠t status
GET    /api/admin/appointments/stats     - L·∫•y th·ªëng k√™
```

### Filter APIs
```
GET    /api/admin/appointments/status/{status}    - L·ªçc theo status
GET    /api/admin/appointments/patient/{patientId} - L·ªçc theo patient
GET    /api/admin/appointments/doctor/{doctorId}   - L·ªçc theo doctor
GET    /api/admin/appointments/date/{date}         - L·ªçc theo ng√†y
```

## C√°ch s·ª≠ d·ª•ng

### 1. Truy c·∫≠p Admin Dashboard
```
http://localhost:3000/admin
```

### 2. Navigation
- **L·ªãch h·∫πn** - Qu·∫£n l√Ω appointments
- **Th·ªëng k√™ l·ªãch h·∫πn** - Xem bi·ªÉu ƒë·ªì v√† th·ªëng k√™

### 3. Qu·∫£n l√Ω Appointments
1. V√†o tab "L·ªãch h·∫πn"
2. S·ª≠ d·ª•ng search v√† filter ƒë·ªÉ t√¨m appointments
3. Click "Xem" ƒë·ªÉ xem chi ti·∫øt
4. Click "S·ª≠a" ƒë·ªÉ ch·ªânh s·ª≠a
5. Click "X√≥a" ƒë·ªÉ x√≥a (c√≥ x√°c nh·∫≠n)

### 4. Xem th·ªëng k√™
1. V√†o tab "Th·ªëng k√™ l·ªãch h·∫πn"
2. Xem c√°c bi·ªÉu ƒë·ªì v√† s·ªë li·ªáu
3. Ph√¢n t√≠ch xu h∆∞·ªõng v√† ph√¢n b·ªë

## Dependencies

### Backend
- Spring Boot 2.7+
- Spring Data JPA
- SQL Server
- Maven

### Frontend
- React 19+
- Axios
- Recharts (for charts)
- Tailwind CSS
- Lucide React (icons)

## L∆∞u √Ω quan tr·ªçng

### 1. Database Compatibility
- S·ª≠ d·ª•ng SQL Server syntax cho date functions
- `CAST(created_at AS DATE)` thay v√¨ `DATE()`
- `GETDATE()` thay v√¨ `NOW()`

### 2. Code Safety
- Kh√¥ng s·ª≠a ƒë·ªïi code c≈© trong `AppointmentService.js`
- Th√™m method m·ªõi m√† kh√¥ng x√≥a code hi·ªán c√≥
- Gi·ªØ nguy√™n class syntax v√† existing methods

### 3. Error Handling
- Loading states cho t·∫•t c·∫£ API calls
- Error messages cho user
- Console logging cho debugging

### 4. Performance
- Lazy loading cho charts
- Debounced search
- Optimized database queries

## Troubleshooting

### 1. Charts kh√¥ng hi·ªÉn th·ªã
- Ki·ªÉm tra `recharts` package ƒë√£ c√†i ƒë·∫∑t
- Ki·ªÉm tra data format t·ª´ API
- Ki·ªÉm tra console errors

### 2. API errors
- Ki·ªÉm tra backend logs
- Ki·ªÉm tra database connection
- Ki·ªÉm tra CORS configuration

### 3. Search kh√¥ng ho·∫°t ƒë·ªông
- Ki·ªÉm tra search term format
- Ki·ªÉm tra API response structure
- Ki·ªÉm tra filter logic

## Future Enhancements

### 1. T√≠nh nƒÉng c√≥ th·ªÉ th√™m:
- Export appointments to Excel/PDF
- Bulk operations (delete multiple, update status)
- Advanced filters (date range, doctor specialty)
- Email notifications
- Calendar view
- Drag & drop scheduling

### 2. Performance improvements:
- Pagination for large datasets
- Virtual scrolling
- Caching strategies
- Real-time updates with WebSocket

### 3. Analytics enhancements:
- More chart types (heatmap, scatter plot)
- Custom date ranges
- Comparative analytics
- Predictive analytics

---

**H·ªá th·ªëng Appointment Management ƒë√£ ho√†n ch·ªânh v√† s·∫µn s√†ng s·ª≠ d·ª•ng! üéâ** 